blueprint:
  name: üîî‚ÄÉNotifications
  domain: script
  source_url: https://github.com/samuelthng/t-house-blueprints/blob/main/notifications.yaml
  description: >-
    <div>
        <h2>üîî Notifications</h2>
        <h4>‚ÄÉVersion 2 Beta 1 - Multi-device | <a href="https://github.com/samuelthng/t-house-blueprints/blob/main/notifications.yaml" target="_blank">üîó Github Link</a><br /></h4>
        <a href="https://my.home-assistant.io/redirect/blueprint_import/?blueprint_url=https%3A%2F%2Fmy.home-assistant.io%2Fredirect%2Fblueprint_import%2F%3Fblueprint_url%3Dhttps%253A%252F%252Fgithub.com%252Fsamuelthng%252Ft-house-blueprints%252Fblob%252Fmain%252Fnotifications.yaml" target="_blank">
        <img src="https://my.home-assistant.io/badges/blueprint_import.svg" alt="Open your Home Assistant instance and show the blueprint import dialog with a specific blueprint pre-filled." />
        </a>
      </div>
      <br>

    ---

    ### Features:

      > üì≤‚ÄÉSends notification to [Home Assistant Companion](https://companion.home-assistant.io/)

      > 3Ô∏è‚É£‚ÄÉUp to 3 customisable, action buttons (Previously: ‚úÖ Confirm and ‚ùå Dismiss Button)

      > ‚åõÔ∏è‚ÄÉTimeout actions with custom duration, fired if no option response received

      > üßπ‚ÄÉClear notification after timeout

      > üì∏‚ÄÉCamera Snapshots

      > üîó‚ÄÉCustom Notification Link

      > üçé‚ÄÉSupports iOS

      > ü§ñ‚ÄÉSupports Android

      Examples can be found [here](https://community.home-assistant.io/t/notification-with-confirm-dismiss-and-timeout/551552#example-usage-6)

    ### Changelog

      <details>
      <summary>Expand/collapse changelog</summary>

      ### Version 2 Beta 1 Multiple Device - *1 Nov 2023*
      - Refactor: Build payload in templates
      - Fixed: iOS showing `Failed to load attachment`

      ### Version 1.6.1 Multiple Device - *31 Oct 2023*
      - Added: Experimental Multiple Device Support

      ### Version 1.6.1 - *26 Oct 2023*
      - Fixed: Camera Snapshots not showing

      ### Version 1.6 - *26 Oct 2023*
      - Added: Show/Hide options toggle
      - Added: URI action options and iOS specific action options
      - Added: Third option

      ### Version 1.5 - *11 Oct 2023* [üîó](https://community.home-assistant.io/t/notifications-actionable-mobile-notifications-script-with-optional-timeout-feature-and-camera-snapshots-works-with-ios-android/551552#version-14-7-jul-2023-8)

      ### Version 1.4 - *7 Jul 2023* [üîó](https://community.home-assistant.io/t/notification-with-confirm-dismiss-and-timeout/551552#version-14-7-jul-2023-8)

      ### Version 1.3.2 - *28 Jun 2023*[üîó](https://community.home-assistant.io/t/notification-with-confirm-dismiss-and-timeout/551552#version-132-28-jun-2023-9)

      ### Version 1.3.1 - *10 Jun 2023* [üîó](https://community.home-assistant.io/t/notification-with-confirm-dismiss-and-timeout/551552#version-131-10-jun-2023-10)

      ### Version 1.3 - *9 Jun 2023* [üîó](https://community.home-assistant.io/t/notification-with-confirm-dismiss-and-timeout/551552#version-13-9-jun-2023-9)

      ### Version 1.2 - *30 May 2023* [üîó](https://community.home-assistant.io/t/notification-with-confirm-dismiss-and-timeout/551552#version-12-30-may-2023-10)

      ### Version 1.1 - *25 March 2023* [üîó](https://community.home-assistant.io/t/notification-with-confirm-dismiss-and-timeout/551552#version-11-25-march-2023-11)

      </details>

    ### Known Issues

      <details>
      <summary>Expand/collapse known issues</summary>

      - In some cases, iOS does not seem to play well with newer features. 
        If that happens to you, you can [check out older releases here](https://github.com/samuelthng/t-house-blueprints/releases).

      - In some cases, some setups have difficulty receiving events from the device.
        When this happens, no actions will be performed by Home Assistant.

        You can test this:
          - Navigate to Developer Tools ‚Üí Events
          - Listen to event: `mobile_app_notification_action`
          - Trigger a notification to your device by running the script
          - Select an action option

        If you do not see an event appearing in the Events page, this could be the issue.
        You might want to check the [troubleshooting documents](https://companion.home-assistant.io/docs/troubleshooting/faqs), or check your network configuration to resolve the issue.

      </details>

    ### FAQ

      <details>
      <summary>Expand/collapse FAQ</summary>

      - **_Will you add sending notifications to multiple devices?_**
        Sadly, no. It is possible to send notifications to multiple devices, however, it will not work as well with the timeout feature and notifications clearing at this time.

        I might revisit it in future, but not at this time.

      - **_Why can't I see my devices or notify service?_**
        You might want to check if troubleshooting steps provided by the [Home Assistant Companion app documentation](https://companion.home-assistant.io/docs/troubleshooting/faqs) may be able to help.

      - **_Why do I keep receiving notifications incessantly?_**
        Check your scripts and automation, there might be a logical loop going on that's triggering the notification over and over again. If you need further help, feel free to drop by the [main post](https://community.home-assistant.io/t/notifications-actionable-mobile-notifications-script-with-optional-timeout-feature-and-camera-snapshots-works-with-ios-android/) and share your automation and scripts yamls.

      </details>
      <br>

  input:
    ##############################
    # Input: Notification Strategy
    ##############################
    notify_type:
      name: "üì≤‚ÄÉNotification Strategy"
      description: >-
        Pick a notification strategy.<br><br>
        üëçüèª‚ÄÉ`Device` is the preferred and default option.<br>
        ‚ö†Ô∏è‚ÄÉEnsure that you have filled the required corresponding fields
      default: "device"
      selector:
        select:
          mode: dropdown
          options:
            - label: Device (üëçüèª Preferred)
              value: device
            - label: Notify Service
              value: notify_service
    notify_device:
      name: "üì≤‚ÄÉDevice(s) to notify"
      description: >-
        Devices needs to run the official [Home Assistant Companion](https://companion.home-assistant.io/) app to receive notifications.<br><br>
        ‚ùî‚ÄÉOnly used with `üì≤‚ÄÉNotification Strategy: Device`<br>
        üëçüèª‚ÄÉ`Device` is the preferred and default option.
        ‚ö†Ô∏è‚ÄÉSending notifications to multiple devices may cause disruptive experience for options and the timeout feature.<br>
      default: ""
      selector:
        device:
          multiple: true
          filter:
            - integration: mobile_app
    notify_service_name:
      name: "üì≤‚ÄÉService to notify"
      description: >-
        Service must be exposed by the Home Assistant [mobile app integration](https://companion.home-assistant.io/docs/notifications/notifications-basic).<br><br>
        ‚ùî‚ÄÉOnly used with `üì≤‚ÄÉNotification Strategy: Notify Service`<br>
        ‚ö†Ô∏è‚ÄÉUse this option only if `Device` option does not show your devices.
      default: ""
      selector:
        text:
          prefix: "notify.mobile_app_"

    ##############################
    # Input: Notification Content
    ##############################
    title:
      name: "üè∑Ô∏è‚ÄÉTitle"
      description: "The title of the notification.  \n\n`Optional`\n"
      default: ""
      selector:
        text:
    subtitle:
      name: "üè∑Ô∏è‚ÄÉSubtitle"
      description: "The subtitle of the notification.  \n\n`Optional`\n"
      default: ""
      selector:
        text:
    message:
      name: "üí¨‚ÄÉMessage"
      description: "The message body to display on the notification.  \n\n`ü§ñ Android`: You may add [HTML formatting](https://companion.home-assistant.io/docs/notifications/notifications-basic?_highlight=tag#notification-message-html-formatting) to customise the look of the message."
      selector:
        text:
    icon:
      name: "üôÇ‚ÄÉIcon"
      description: "Custom icon for this notification.  \n\n`ü§ñ Android Only`, `Optional`"
      default: ""
      selector:
        icon:
    enable_icon_color:
      name: "üé®‚ÄÉUse Icon Color"
      description: "If disabled, uses default icon color.  \n\n`ü§ñ Android Only`, `Optional`"
      default: false
      selector:
        boolean:
    icon_color:
      name: "üé®‚ÄÉIcon Color"
      description: "Custom icon color for this notification.  \n\n`ü§ñ Android Only`, `Optional`"
      default: [102, 186, 240]
      selector:
        color_rgb:

    ##############################
    # Input: Response Options
    ##############################

    ## Option 1
    confirm_enabled:
      name: "1Ô∏è‚É£‚ÄÉOption 1"
      description: "Show or hide this option."
      default: True
      selector:
        boolean:

    confirm_text:
      name: "1Ô∏è‚É£‚ÄÉOption 1 - Title"
      description: "Title to show on the first option."
      default: "Confirm"
      selector:
        text:

    confirm_option_mode:
      name: "1Ô∏è‚É£‚ÄÉOption 1 - Mode"
      description: >-
        Action mode for this option.<br /><br />
        If you need this option to do nothing, pick `Mode: Action(s)` here and leave the `Action(s)` input empty for this option.<br /><br />

        <details>
            <summary>‚ùî What is this?</summary>

          This option is only applicable to Android due to technical limitations. 
                    
          The android app can't sending events and open links on the device at the same time, using the same option.

          As such, options on the android app can only be either a link, or an action on Home Assistant. Not both.

          This is due to:

          - The lack of events being sent when URI options are fired.
          - The requirement to set the `action` parameter to `"URI"`.

          </details>

        Ô£ø‚ÄÉiOS: Ignore this, iOS will run both actions and links if they are set.<br /><br />
        `ü§ñ‚ÄÉAndroid Only`, `Optional`
      default: ""
      selector:
        select:
          mode: dropdown
          options:
            - label: ""
              value: ""
            - label: Action(s)
              value: action
            - label: "Link (ü§ñ Android Only)"
              value: uri

    confirm_action:
      name: "1Ô∏è‚É£‚ÄÉOption 1 - Action(s)"
      description: "Action(s) to run when this option is selected.\n\n‚ùî‚ÄÉUsed with `Mode: Action(s)` option\n‚ùî‚ÄÉScript stops after actions are run\n‚ùî‚ÄÉLeave empty to do nothing\n`Optional`"
      default: []
      selector:
        action:

    confirm_uri:
      name: "1Ô∏è‚É£‚ÄÉOption 1 - Link"
      description: >-
        Navigate to a link or app when this option is selected.<br />

        <details>
          <summary>üîó Show Common Examples</summary>

        - To **open a Home Assistant view**, use relative links like these:
          `/lovelace/my-dashboard`
          `/config/dashboard`
          `/developer-tools/template`

        - Use **launch a page in your default browser**,
          select the appropriate `Link` option in modes and enter a URL here:
          `https://example.com`

          </details><br />

        <details>
          <summary>ü§ñ Show Android Specific Examples</summary>

        - To **open an Application** on your device, for example:
          `app://<android application package name>`
          `app://io.homeassistant.companion.android`

        - To **view an Entity** on your Home Assistant setup:
          `entityId:<your_entity_id>`
          `entityId:sun.sun`

        - To use [**Intent scheme URIs**](https://developer.chrome.com/docs/multidevice/android/intents/#syntax):
          `intent://scan/#Intent;scheme=zxing;package=com.my.pkg;end`

        - To use [**Deep links**](https://developer.android.com/training/app-links#deep-links):
          `deep-link://<deep_link_here>`
          `deep-link://example://link/to/content`

        - To **see notification history**:
          `settings://notification_history`

          </details><br />

        <details>
          <summary>Ô£ø Show iOS Specific Examples</summary>

        - Use **application-launching URLs** on your device
          `tel:123456789`
          `mailto:my@email.com`

          </details><br />

        ‚ùî‚ÄÉAndroid: Used with `Mode: Link` options<br />
        ‚ùî‚ÄÉiOS: Leave empty to disable<br />
        ‚ö†Ô∏è‚ÄÉAndroid: Using this option **WILL NOT STOP** timeout countdown. Please triple check actions that will be run in `Timeout Action(s)`.<br /><br />
        `Optional`
      default: ""
      selector:
        text:
          type: url

    confirm_icon:
      name: "1Ô∏è‚É£‚ÄÉOption 1 - Icon"
      description: "Custom icon to show on this option.  \n\nPlease refer to the [documentation here](https://companion.home-assistant.io/docs/notifications/actionable-notifications#icon-values).  \nThere are many reference pages out there, feel use a [search engine](https://www.google.com/search?q=sfsymbols+reference+list)!  \n\n`Ô£ø iOS Only`, `Optional`"
      default: ""
      selector:
        text:
          prefix: "sfsymbols:"

    confirm_is_destructive:
      name: "1Ô∏è‚É£‚ÄÉOption 1 - Destructive"
      description: "Set the action's title to be red, indicating a destructive action.  \n\n`Ô£ø iOS Only`, `Optional`"
      default: false
      selector:
        boolean:

    confirm_authentication_required:
      name: "1Ô∏è‚É£‚ÄÉOption 1 - Authentication Required"
      description: "Require device to be unlocked to use this option.  \n\n`Ô£ø iOS Only`, `Optional`"
      default: false
      selector:
        boolean:

    ## Option 2
    dismiss_enabled:
      name: "2Ô∏è‚É£‚ÄÉOption 2"
      description: "Show or hide this option."
      default: True
      selector:
        boolean:

    dismiss_text:
      name: "2Ô∏è‚É£‚ÄÉOption 2 - Title"
      description: "Title to show on the first option."
      default: "Confirm"
      selector:
        text:

    dismiss_option_mode:
      name: "2Ô∏è‚É£‚ÄÉOption 2 - Mode"
      description: >-
        Action mode for this option.<br /><br />
        If you need this option to do nothing, pick `Mode: Action(s)` here and leave the `Action(s)` input empty for this option.<br /><br />

        <details>
            <summary>‚ùî What is this?</summary>

          This option is only applicable to Android due to technical limitations. 
                    
          The android app can't sending events and open links on the device at the same time, using the same option.

          As such, options on the android app can only be either a link, or an action on Home Assistant. Not both.

          This is due to:

          - The lack of events being sent when URI options are fired.
          - The requirement to set the `action` parameter to `"URI"`.

          </details>

        Ô£ø‚ÄÉiOS: Ignore this, iOS will run both actions and links if they are set.<br /><br />
        `ü§ñ‚ÄÉAndroid Only`, `Optional`
      default: ""
      selector:
        select:
          mode: dropdown
          options:
            - label: ""
              value: ""
            - label: Action(s)
              value: action
            - label: "Link (ü§ñ Android Only)"
              value: uri

    dismiss_action:
      name: "2Ô∏è‚É£‚ÄÉOption 2 - Action(s)"
      description: "Action(s) to run when this option is selected.\n\n‚ùî‚ÄÉUsed with `Mode: Action(s)` option\n‚ùî‚ÄÉScript stops after actions are run\n‚ùî‚ÄÉLeave empty to do nothing\n`Optional`"
      default: []
      selector:
        action:

    dismiss_uri:
      name: "2Ô∏è‚É£‚ÄÉOption 2 - Link"
      description: >-
        Navigate to a link or app when this option is selected.<br />

        <details>
          <summary>üîó Show Common Examples</summary>

        - To **open a Home Assistant view**, use relative links like these:
          `/lovelace/my-dashboard`
          `/config/dashboard`
          `/developer-tools/template`

        - Use **launch a page in your default browser**,
          select the appropriate `Link` option in modes and enter a URL here:
          `https://example.com`

          </details><br />

        <details>
          <summary>ü§ñ Show Android Specific Examples</summary>

        - To **open an Application** on your device, for example:
          `app://<android application package name>`
          `app://io.homeassistant.companion.android`

        - To **view an Entity** on your Home Assistant setup:
          `entityId:<your_entity_id>`
          `entityId:sun.sun`

        - To use [**Intent scheme URIs**](https://developer.chrome.com/docs/multidevice/android/intents/#syntax):
          `intent://scan/#Intent;scheme=zxing;package=com.my.pkg;end`

        - To use [**Deep links**](https://developer.android.com/training/app-links#deep-links):
          `deep-link://<deep_link_here>`
          `deep-link://example://link/to/content`

        - To **see notification history**:
          `settings://notification_history`

          </details><br />

        <details>
          <summary>Ô£ø Show iOS Specific Examples</summary>

        - Use **application-launching URLs** on your device
          `tel:123456789`
          `mailto:my@email.com`

          </details><br />

        ‚ùî‚ÄÉAndroid: Used with `Mode: Link` options<br />
        ‚ùî‚ÄÉiOS: Leave empty to disable<br />
        ‚ö†Ô∏è‚ÄÉAndroid: Using this option **WILL NOT STOP** timeout countdown. Please triple check actions that will be run in `Timeout Action(s)`.<br /><br />
        `Optional`
      default: ""
      selector:
        text:
          type: url

    dismiss_icon:
      name: "2Ô∏è‚É£‚ÄÉOption 2 - Icon"
      description: "Custom icon to show on this option.  \n\nPlease refer to the [documentation here](https://companion.home-assistant.io/docs/notifications/actionable-notifications#icon-values).  \nThere are many reference pages out there, feel use a [search engine](https://www.google.com/search?q=sfsymbols+reference+list)!  \n\n`Ô£ø iOS Only`, `Optional`"
      default: ""
      selector:
        text:
          prefix: "sfsymbols:"

    dismiss_is_destructive:
      name: "2Ô∏è‚É£‚ÄÉOption 2 - Destructive"
      description: "Set the action's title to be red, indicating a destructive action.  \n\n`Ô£ø iOS Only`, `Optional`"
      default: false
      selector:
        boolean:

    dismiss_authentication_required:
      name: "2Ô∏è‚É£‚ÄÉOption 2 - Authentication Required"
      description: "Require device to be unlocked to use this option.  \n\n`Ô£ø iOS Only`, `Optional`"
      default: false
      selector:
        boolean:

    ## Option 3
    option_three_enabled:
      name: "3Ô∏è‚É£‚ÄÉOption 3"
      description: "Show or hide this option."
      default: false
      selector:
        boolean:

    option_three_text:
      name: "3Ô∏è‚É£‚ÄÉOption 3 - Title"
      description: "Title to show on the first option."
      default: "Option 3"
      selector:
        text:

    option_three_option_mode:
      name: "3Ô∏è‚É£‚ÄÉOption 3 - Mode"
      description: >-
        Action mode for this option.<br /><br />
        If you need this option to do nothing, pick `Mode: Action(s)` here and leave the `Action(s)` input empty for this option.<br /><br />

        <details>
            <summary>‚ùî What is this?</summary>

          This option is only applicable to Android due to technical limitations. 
                    
          The android app can't sending events and open links on the device at the same time, using the same option.

          As such, options on the android app can only be either a link, or an action on Home Assistant. Not both.

          This is due to:

          - The lack of events being sent when URI options are fired.
          - The requirement to set the `action` parameter to `"URI"`.

          </details>

        Ô£ø‚ÄÉiOS: Ignore this, iOS will run both actions and links if they are set.<br /><br />
        `ü§ñ‚ÄÉAndroid Only`, `Optional`
      default: ""
      selector:
        select:
          mode: dropdown
          options:
            - label: ""
              value: ""
            - label: Action(s)
              value: action
            - label: "Link (ü§ñ Android Only)"
              value: uri

    option_three_action:
      name: "3Ô∏è‚É£‚ÄÉOption 3 - Action(s)"
      description: "Action(s) to run when this option is selected.\n\n‚ùî‚ÄÉUsed with `Mode: Action(s)` option\n‚ùî‚ÄÉScript stops after actions are run\n‚ùî‚ÄÉLeave empty to do nothing\n`Optional`"
      default: []
      selector:
        action:

    option_three_uri:
      name: "3Ô∏è‚É£‚ÄÉOption 3 - Link"
      description: >-
        Navigate to a link or app when this option is selected.<br />

        <details>
          <summary>üîó Show Common Examples</summary>

        - To **open a Home Assistant view**, use relative links like these:
          `/lovelace/my-dashboard`
          `/config/dashboard`
          `/developer-tools/template`

        - Use **launch a page in your default browser**,
          select the appropriate `Link` option in modes and enter a URL here:
          `https://example.com`

          </details><br />

        <details>
          <summary>ü§ñ Show Android Specific Examples</summary>

        - To **open an Application** on your device, for example:
          `app://<android application package name>`
          `app://io.homeassistant.companion.android`

        - To **view an Entity** on your Home Assistant setup:
          `entityId:<your_entity_id>`
          `entityId:sun.sun`

        - To use [**Intent scheme URIs**](https://developer.chrome.com/docs/multidevice/android/intents/#syntax):
          `intent://scan/#Intent;scheme=zxing;package=com.my.pkg;end`

        - To use [**Deep links**](https://developer.android.com/training/app-links#deep-links):
          `deep-link://<deep_link_here>`
          `deep-link://example://link/to/content`

        - To **see notification history**:
          `settings://notification_history`

          </details><br />

        <details>
          <summary>Ô£ø Show iOS Specific Examples</summary>

        - Use **application-launching URLs** on your device
          `tel:123456789`
          `mailto:my@email.com`

          </details><br />

        ‚ùî‚ÄÉAndroid: Used with `Mode: Link` options<br />
        ‚ùî‚ÄÉiOS: Leave empty to disable<br />
        ‚ö†Ô∏è‚ÄÉAndroid: Using this option **WILL NOT STOP** timeout countdown. Please triple check actions that will be run in `Timeout Action(s)`.<br /><br />
        `Optional`
      default: ""
      selector:
        text:
          type: url

    option_three_icon:
      name: "3Ô∏è‚É£‚ÄÉOption 3 - Icon"
      description: "Custom icon to show on this option.  \n\nPlease refer to the [documentation here](https://companion.home-assistant.io/docs/notifications/actionable-notifications#icon-values).  \nThere are many reference pages out there, feel use a [search engine](https://www.google.com/search?q=sfsymbols+reference+list)!  \n\n`Ô£ø iOS Only`, `Optional`"
      default: ""
      selector:
        text:
          prefix: "sfsymbols:"

    option_three_is_destructive:
      name: "3Ô∏è‚É£‚ÄÉOption 3 - Destructive"
      description: "Set the action's title to be red, indicating a destructive action.  \n\n`Ô£ø iOS Only`, `Optional`"
      default: false
      selector:
        boolean:

    option_three_authentication_required:
      name: "3Ô∏è‚É£‚ÄÉOption 3 - Authentication Required"
      description: "Require device to be unlocked to use this option.  \n\n`Ô£ø iOS Only`, `Optional`"
      default: false
      selector:
        boolean:

    ##############################
    # Input: Timeout Options
    ##############################
    enable_timeout:
      name: "‚åõÔ∏è‚ÄÉEnable Timeout"
      description: "Require script to stop listening after the set duration.<br><br>üëçüèª‚ÄÉRecommended to enable.<br>‚ö†Ô∏è‚ÄÉIf disabled, script will wait for response indefinitely until the next time it is triggered."
      default: true # Default `true` for backward compatibility.
      selector:
        boolean:
    timeout:
      name: "‚åõÔ∏è‚ÄÉTimeout Duration"
      description: "Amount of time to wait for an action response before firing timeout action.  \n\nüëçüèª‚ÄÉRecommended: ‚â•1 minute, to allow notifications to be sent.  \nDefault: 15 minutes. \n"
      default:
        hours: 0
        minutes: 15
        seconds: 0
      selector:
        duration:
          enable_day: false
    timeout_action:
      name: "‚åõÔ∏è‚ÄÉTimeout Action(s)"
      description: "Action to run when notification response is timed out.  \n\n‚ùî Leave empty if no actions should be run  \n\n‚ö†Ô∏è Android Users: Note, URI options do not stop the timeout countdown. This action could be run after pressing the URI option.\n‚ùî Android Users: Workaround for the above, you may disable `‚åõÔ∏è‚ÄÉRun timeout action(s) when notification cleared` and manually clear the notification after selecting your URI option. \n\n`Optional`"
      default: []
      selector:
        action:
    swipe_away_as_timeout:
      name: "‚åõÔ∏è‚ÄÉRun timeout action(s) when notification cleared"
      description: "If enabled, swiping the notification away will immediately trigger timeout actions.  \n\n`ü§ñ Android Only`"
      default: false
      selector:
        boolean:
    clear_on_timeout:
      name: "üßπ‚ÄÉClear notification on timeout"
      description: "Dismiss the notification after action selection times out."
      default: false
      selector:
        boolean:
    persist:
      name: "üö©‚ÄÉPersistent Notification"
      description: "Prevents notifications from being swiped away by accident.  \n\n‚ùî This option blocks `‚åõÔ∏è‚ÄÉRun timeout action(s) when notification cleared`  \n\n`ü§ñ Android Only`"
      default: false
      selector:
        boolean:
    car_ui:
      name: "üöò‚ÄÉShow on Android Auto"
      description: "Display notification on Android Auto interface.  \n\n`ü§ñ Android Only`"
      default: false
      selector:
        boolean:

    ##############################
    # Input: Notification Link
    ##############################
    notification_link:
      name: "üîó‚ÄÉNotification Link"
      description: "Link to navigate to upon clicking the notification.  \n\n Examples:  \n - Home Assistant relative links: `/config/updates` or `/lovelace/home`  \n - Apps: `app://<package name>`  \n - Entity `More Info` Panel: `entityId:<entity_ID>`  \n - Deep links: `deep-link://<deep_link>`  \n\nSee [documentation](https://companion.home-assistant.io/docs/notifications/notifications-basic/#opening-a-url) for more information and options.  \n\n`Optional`"
      default: ""
      selector:
        text:

    ##############################
    # Input: Attachments
    ##############################
    attachment_type:
      name: "üì∏‚ÄÉAttachment Type"
      description: >
        Choose to send an attachment along with the notification.<br>

        `Optional`
      default: "none"
      selector:
        select:
          options:
            - label: "None"
              value: "none"
            - label: "Camera"
              value: "camera_entity"
    attachment_camera_entity:
      name: "üì∏‚ÄÉAttachment: Camera Entity"
      description: >-
        Camera Entity to display snapshots of on the notification.<br>

        Please note, iOS and Android have differing vehaviours, as specified in the documentation.
        See the links below for more information.

        <table><tr><td>‚ÄÉ<a target="_blank" href="https://companion.home-assistant.io/docs/notifications/dynamic-content#camera-stream">Ô£ø Camera Stream</a></td><td>‚ÄÉ<a target="_blank" href="https://companion.home-assistant.io/docs/notifications/notification-attachments#automatic-snapshots">ü§ñ Automatic Snapshots</a></td></tr></table><br>

        ‚ùî‚ÄÉOnly used with `Attachment Type: Camera`
      default: ""
      selector:
        entity:
          filter:
            - domain: "camera"

    ##############################
    # Input: Misc Inputs
    ##############################
    tag:
      name: "üîñ‚ÄÉTag"
      description: "Used to uniquely identify the notification.  \n\nUse tag if you are using this script with other notification services.  \nLeave empty otherwise.  \n\nExample: `my_awesome_notification_for_device_X`  \n\nüëçüèª‚ÄÉRecommended to leave empty\n`Optional`"
      default: ""
      selector:
        text:
    group:
      name: "üì£‚ÄÉNotification Group ID"
      description: "Used for grouping different notifications together visually.  \n\n‚ö†Ô∏è‚ÄÉiOS critical notifications do no support grouping.  \nSee [documentation](https://companion.home-assistant.io/docs/notifications/notifications-basic?_highlight=tag#grouping) for more information.  \n\n`Optional`"
      default: ""
      selector:
        text:
    channel:
      name: "üì£‚ÄÉNotification Channel"
      description: "Defines the channel, to be used with Importance.  \nRelates to the importance of the notification.  \n\n`ü§ñ Android Only`, `Optional`"
      default: "General"
      selector:
        text:
    importance:
      name: "‚ùï‚ÄÉNotification Channel Importance"
      description: "See [documentation](https://companion.home-assistant.io/docs/notifications/notifications-basic/#notification-channel-importance) for more information.  \n\n`ü§ñ Android Only`"
      default: default
      selector:
        select:
          options:
            - label: "Urgent (Makes a sound with heads-up notification)"
              value: high
            - label: "Default (Makes a sound)"
              value: default
            - label: "Silent (Makes no sound)"
              value: low
            - label: "Low (Makes no sound, doesn't appear in status bar)"
              value: min
    interruption_level:
      name: "‚ùï‚ÄÉInterruption Level"
      description: "See [documentation](https://companion.home-assistant.io/docs/notifications/notifications-basic/#interruption-level) for more information.  \n\n`Ô£ø iOS Only`"
      default: active
      selector:
        select:
          options:
            - label: "Silent (Makes no sound, does not wake screen)"
              value: passive
            - label: "Default"
              value: active
            - label: "Important (Overrides Focus)"
              value: time-sensitive
            - label: "Critical (Overrides Focus and Mute, restricted features)"
              value: critical
    visibility:
      name: "üîè‚ÄÉNotification Lockscreen Visibility"
      description: "Show or hide notification content on the lockscreen.  \nSee [documentation](https://companion.home-assistant.io/docs/notifications/notifications-basic?_highlight=tag#notification-sensitivity--lock-screen-visibility) for more information.  \n\nDefault: `Private`  \n\n`ü§ñ Android Only`"
      default: "private"
      selector:
        select:
          options:
            - label: "Public: Always show content."
              value: public
            - label: "Private: Show content based on phone settings."
              value: private
            - label: "Secret: Always hide content on the lockscreen."
              value: secret

mode: restart

sequence:
  ##############################
  # Setup Variables
  ##############################
  - alias: "Setup variables"
    variables:
      subtitle: !input subtitle
      interruption_level: !input interruption_level
      notification_link: !input notification_link
      visibility: !input visibility
      importance: !input importance
      custom_tag: !input tag # No need for manual definition anymore, treat existing definitions as custom tags.
      first_option: "{{ 'FIRST_' ~ context.id }}"
      second_option: "{{ 'SECOND_' ~ context.id }}"
      third_option: "{{ 'THIRD_' ~ context.id }}"
      enable_timeout: !input enable_timeout
      clear_on_timeout: !input clear_on_timeout
      persist: !input persist
      timeout: !input timeout # Load timeout into variable for use with templates.
      timeout_seconds: "{{ (timeout.hours * 60 + timeout.minutes) * 60 + timeout.seconds }}"
      car_ui: !input car_ui
      icon: !input icon
      enable_icon_color: !input enable_icon_color
      icon_color_selector: !input icon_color
      icon_color_hex: '{{ "#{:02x}{:02x}{:02x}".format(icon_color_selector[0], icon_color_selector[1], icon_color_selector[2]) }}'
      swipe_away_as_timeout: !input swipe_away_as_timeout
      attachment_type: !input attachment_type
      attachment_camera_entity: !input attachment_camera_entity
      camera_image_url: >-
        {% if (attachment_camera_entity|length) %}
          {% if (state_attr(attachment_camera_entity,'entity_picture')|length) %}
            {{state_attr(attachment_camera_entity,'entity_picture')}}
          {% else %}
            {{"/api/camera_proxy/{id}".format(id=attachment_camera_entity)}}
          {%- endif %}
        {%- endif %}
      media_url: >-
        {{
          {
            'none': '',
            'camera_entity': iif(camera_image_url | length, camera_image_url)
          }.get(attachment_type)
        }}
      notify_type: !input notify_type
      notify_device: !input notify_device
      notify_service_name: !input notify_service_name
      notify_service: >-
        {% if notify_type == 'device' %}
          {% if notify_device is iterable and (notify_device is not string and notify_device is not mapping) %}
            {% set devices = namespace(data = [])%}
            {% for device in notify_device %}
              {% set devices.data = devices.data + ["notify.mobile_app_{id}".format(id=device_attr(device,'name')|slugify)] %}
            {% endfor %}
            {{ devices.data | list }}
          {% else %}
            {{ ["notify.mobile_app_{id}".format(id=device_attr(notify_device,'name')|slugify)] | list }}
          {% endif %}
        {% elif notify_type == 'notify_service' %}
        {{ ["notify.mobile_app_{id}".format(id=notify_service_name|slugify)] | list }}
        {%- endif %}
      option_one_enabled: !input confirm_enabled
      option_one_title: !input confirm_text
      option_one_mode: !input confirm_option_mode
      option_one_actions: !input confirm_action
      option_one_uri: !input confirm_uri
      option_one_icon_value: !input confirm_icon
      option_one_icon: >-
        {% if 'sfsymbols:' in option_one_icon_value %}
        {{ option_one_icon_value }}
        {% elif option_one_icon_value | length %}
        {{ "sfsymbols:{icon}".format(icon=option_one_icon_value) }}
        {%- endif %}
      option_one_is_destructive: !input confirm_is_destructive
      option_one_auth_required: !input confirm_authentication_required
      option_one_action: >-
        {% if option_one_mode == 'uri' %}
        {{ 'URI' }}
        {% else %}
        {{ first_option }}
        {% endif %}
      option_one: >-
        {{ {
          'enabled': option_one_enabled,
          'action': option_one_action,
          'title': option_one_title,
          'actions': option_one_actions,
          'icon': option_one_icon,
          'destructive': option_one_is_destructive,
          'authenticationRequired': option_one_auth_required,
          "{}".format('uri' if option_one_uri|length else ''): option_one_uri,
        } }}
      option_two_enabled: !input dismiss_enabled
      option_two_title: !input dismiss_text
      option_two_mode: !input dismiss_option_mode
      option_two_actions: !input dismiss_action
      option_two_uri: !input dismiss_uri
      option_two_icon_value: !input dismiss_icon
      option_two_icon: >-
        {% if 'sfsymbols:' in option_two_icon_value %}
        {{ option_two_icon_value }}
        {% elif option_two_icon_value | length %}
        {{ "sfsymbols:{icon}".format(icon=option_two_icon_value) }}
        {%- endif %}
      option_two_is_destructive: !input dismiss_is_destructive
      option_two_auth_required: !input dismiss_authentication_required
      option_two_action: >-
        {% if option_two_mode == 'uri' %}
        {{ 'URI' }}
        {% else %}
        {{ second_option }}
        {% endif %}
      option_two: >-
        {{{
          'enabled': option_two_enabled,
          'action': option_two_action,
          'title': option_two_title,
          'actions': option_two_actions,
          'icon': option_two_icon,
          'destructive': option_two_is_destructive,
          'authenticationRequired': option_two_auth_required,
          "{}".format('uri' if option_two_uri|length else ''): option_two_uri,
        }}}
      option_three_enabled: !input option_three_enabled
      option_three_title: !input option_three_text
      option_three_mode: !input option_three_option_mode
      option_three_actions: !input option_three_action
      option_three_uri: !input option_three_uri
      option_three_icon_value: !input option_three_icon
      option_three_icon: >-
        {% if 'sfsymbols:' in option_three_icon_value %}
        {{ option_three_icon_value }}
        {% elif option_three_icon_value | length %}
        {{ "sfsymbols:{icon}".format(icon=option_three_icon_value) }}
        {%- endif %}
      option_three_is_destructive: !input option_three_is_destructive
      option_three_auth_required: !input option_three_authentication_required
      option_three_action: >-
        {% if option_three_mode == 'uri' %}
        {{ 'URI' }}
        {% else %}
        {{ third_option }}
        {% endif %}
      option_three: >-
        {{{
          'enabled': option_three_enabled,
          'action': option_three_action,
          'title': option_three_title,
          'actions': option_three_actions,
          'icon': option_three_icon,
          'destructive': option_three_is_destructive,
          'authenticationRequired': option_three_auth_required,
          "{}".format('uri' if option_three_uri|length else ''): option_three_uri,
        }}}
      options: >-
        {{ [option_one, option_two, option_three] | selectattr('enabled') | list }}
      tag: "{{ iif(custom_tag|length, tag, this.entity_id ~ '-' ~ context.id) }}"
      # Build OS specific notification payloads.
      notification_data: >-
        {% set notifications = namespace(data=[])%}
        {% set memo = namespace(data={})%}
        {% for device in notify_device %}
          {% set apple_device = 'APPLE' in (device_attr(device, "manufacturer")|upper) %}
          {% set memo_key = 'APPLE' if apple_device else 'ANDROID' %}
          {% if not memo_key in memo.data %}
            {# If OS payload not built yet, evaluate it. #}
            {% set p = namespace(d={ 'apple_device': apple_device }) %}
            {% if p.d.apple_device %}
              {# iOS #}
              {% set push = namespace(d={}) %}
              {% set p.d = dict(p.d, **{ 'subtitle': subtitle }) %}
              {% set push.d = dict(push.d, **{ 'interruption-level': interruption_level }) %}
              {% if notification_link|length %}{% set p.d = dict(p.d, **{ 'url': notification_link }) %}{% endif %}
              {% if attachment_type == 'camera_entity' %}{% set p.d = dict(p.d, **{ 'entity_id': attachment_camera_entity }) %}{% endif %}
              {% set p.d = dict(p.d, **{ 'push': push.d }) %}
            {% else %}
              {# Android #}
              {% set p.d = dict(p.d, **{ 'subject': subtitle }) %}
              {% set p.d = dict(p.d, **{ 'visibility': visibility }) %}
              {% set p.d = dict(p.d, **{ 'importance': importance }) %}
              {% if notification_link|length %}{% set p.d = dict(p.d, **{ 'clickAction': notification_link }) %}{% endif %}
              {% if attachment_type == 'camera_entity' and (media_url|length) %}{% set p.d = dict(p.d, **{ 'image': media_url }) %}{% endif %}
              {% if icon|length %}{% set p.d = dict(p.d, **{ 'notification_icon': icon }) %}{% endif %}
              {% if enable_icon_color %}{% set p.d = dict(p.d, **{ 'color': icon_color_hex }) %}{% endif %}
              {% if enable_timeout and clear_on_timeout %}{% set p.d = dict(p.d, **{ 'timeout': timeout_seconds }) %}{% endif %}
              {% if channel|length %}{% set p.d = dict(p.d, **{ 'channel': channel }) %}{% endif %}
              {% if persist %}{% set p.d = dict(p.d, **{ 'persistent': persist }) %}{% endif %}
              {% if car_ui %}{% set p.d = dict(p.d, **{ 'car_ui': car_ui }) %}{% endif %}
            {% endif %}
            {# Common  #}
            {% set p.d = dict(p.d, **{ 'actions': options }) %}
            {% set p.d = dict(p.d, **{ 'tag': tag }) %}
            {% if group|length %}{% set p.d = dict(p.d, **{ 'group': group }) %}{% endif %}
            {# Push payload to array  #}
            {% set memo.data = dict(memo.data, **{ "{}".format(memo_key): p.d }) %}
          {% endif %}
          {# Update notification data array with the memoized payload. #}
          {% set notifications.data = notifications.data + [memo.data[memo_key]] %}
        {% endfor %}
        {{ notifications.data }}

  ##############################
  # Send Notification
  ##############################
  - alias: "Send notification"
    repeat:
      for_each: "{{ notify_service }}"
      sequence:
        - service: "{{ repeat.item }}"
          data:
            title: !input title
            message: !input message
            data: >-
              {{ notification_data[repeat.index - 1] }}

  ##############################
  # Evaluate Response
  ##############################
  - if:
      - alias: "Should await response with timeout?"
        condition: template
        value_template: "{{ enable_timeout == true }}"
    then:
      - alias: "Awaiting response with timeout‚Ä¶"
        wait_for_trigger:
          - platform: event
            event_type: mobile_app_notification_action
            event_data:
              action: "{{ first_option }}"
          - platform: event
            event_type: mobile_app_notification_action
            event_data:
              action: "{{ second_option }}"
          - platform: event
            event_type: mobile_app_notification_action
            event_data:
              action: "{{ third_option }}"
          - platform: event
            event_type: mobile_app_notification_cleared
            event_data:
              tag: "{{ tag }}"
        timeout: "{{ timeout }}"
        continue_on_timeout: true
    else:
      - alias: "Awaiting response indefinitely‚Ä¶"
        wait_for_trigger:
          - platform: event
            event_type: mobile_app_notification_action
            event_data:
              action: "{{ first_option }}"
          - platform: event
            event_type: mobile_app_notification_action
            event_data:
              action: "{{ second_option }}"
          - platform: event
            event_type: mobile_app_notification_action
            event_data:
              action: "{{ third_option }}"
          - platform: event
            event_type: mobile_app_notification_cleared
            event_data:
              tag: "{{ tag }}"

  ##############################
  # Trigger Response Actions
  ##############################
  - choose:
      - alias: "Trigger: Timeout"
        conditions: "{{ wait.trigger == none }}"
        sequence: !input timeout_action
      - alias: "Trigger: Notification Cleared"
        conditions: "{{ swipe_away_as_timeout and wait.trigger.event.event_type == 'mobile_app_notification_cleared' }}"
        sequence: !input timeout_action
      - alias: "Trigger: first_option"
        conditions: "{{ wait.trigger.event.data.action == option_one['action'] }}"
        sequence: !input confirm_action
      - alias: "Trigger: second_option"
        conditions: "{{ wait.trigger.event.data.action == option_two['action'] }}"
        sequence: !input dismiss_action
      - alias: "Trigger: second_option"
        conditions: "{{ wait.trigger.event.data.action == option_three['action'] }}"
        sequence: !input option_three_action

  ##############################
  # Compatibility: iOS Clear Notification
  ##############################
  - alias: "Send clear notification commands"
    repeat:
      for_each: "{{ notify_service }}"
      sequence:
        - if:
            - alias: "Should send clear notification command? (for iOS/macOS)?"
              condition: template
              value_template: "{{ enable_timeout and clear_on_timeout and notification_data[repeat.index - 1].apple_device }}"
          then:
            - alias: "Send clear notification command to iOS device"
              service: "{{ repeat.item }}"
              data:
                message: "clear_notification"
                data:
                  tag: "{{ tag }}"
